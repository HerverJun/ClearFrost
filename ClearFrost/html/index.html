<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>清霜 Pro - 汝窑版 (v2.0)</title>



    <!-- Tailwind Config (Define Config BEFORE Library for Robustness) -->
    <script src="js/tailwind-config.js"></script>
    <script src="tailwind.min.js"></script>
    <script src="chart.min.js"></script>
    <link href="cropper.min.css" rel="stylesheet">
    <script src="cropper.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body
    class="bg-frost-gradient h-screen w-screen overflow-hidden flex flex-col text-ink-600 selection:bg-celadon-100 selection:text-celadon-900">

    <!-- Header: Floating HUD -->
    <header
        class="fixed top-6 left-6 right-6 h-16 glass-panel rounded-2xl z-50 flex items-center justify-between px-6 animate-float"
        style="animation-duration: 8s;" onmousedown="startDrag(event)">
        <!-- Left: Logo & Title (Draggable) -->
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-celadon-400 to-celadon-600 flex items-center justify-center text-white shadow-lg shadow-celadon-500/30"
                style="background: linear-gradient(135deg, #415065 0%, #2c5a71 100%);">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v18m0-18l4 4m-4-4l-4 4m4 14l4-4m-4 4l-4-4m9-5H3m18 0l-4-4m4 4l-4 4M3 12l4-4m-4 4l4 4">
                    </path>
                </svg>
            </div>
            <div class="flex flex-col select-none">
                <h1
                    class="text-xl font-serif font-black tracking-widest text-ink-800 bg-clip-text text-transparent bg-gradient-to-r from-ink-900 to-ink-600">
                    清霜 <span
                        class="text-xs font-sans font-medium text-celadon-600 align-middle px-1.5 py-0.5 bg-celadon-50 rounded-md border border-celadon-100 ml-1">Pro</span>
                </h1>
            </div>
        </div>

        <!-- Center: Status Pills -->
        <div class="hidden md:flex items-center gap-3">
            <div class="px-4 py-1.5 rounded-full bg-white/50 border border-white flex items-center gap-2 shadow-sm">
                <span id="header-status-cam" class="w-2 h-2 rounded-full bg-slate-300 transition-colors"></span>
                <span class="text-xs font-bold text-ink-600">Camera</span>
            </div>
            <div class="w-px h-4 bg-ink-400/20"></div>
            <div class="px-4 py-1.5 rounded-full bg-white/50 border border-white flex items-center gap-2 shadow-sm">
                <span id="header-status-plc" class="w-2 h-2 rounded-full bg-slate-300 transition-colors"></span>
                <span class="text-xs font-bold text-ink-600">PLC</span>
            </div>
            <div class="w-px h-4 bg-ink-400/20"></div>
            <div class="px-4 py-1.5 rounded-full bg-white/50 border border-white flex items-center gap-2 shadow-sm"
                title="PLC触发信号监控">
                <span id="header-status-trigger" class="w-2 h-2 rounded-full bg-slate-300 transition-all"></span>
                <span class="text-xs font-bold text-ink-600">触发</span>
            </div>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2">



            <button onclick="showPasswordModal()"
                class="p-2.5 rounded-xl hover:bg-white hover:text-celadon-600 transition-colors text-ink-500 btn-press"
                title="系统设置">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
            <div class="w-px h-6 bg-ink-400/20 mx-1"></div>
            <button
                class="p-2.5 rounded-xl hover:bg-slate-100 hover:text-ink-800 transition-colors text-ink-500 btn-press"
                onclick="sendCommand('toggle_maximize')" title="最大化/还原">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">
                    </path>
                </svg>
            </button>
            <button
                class="p-2.5 rounded-xl hover:bg-rose-50 hover:text-rose-600 transition-colors text-ink-500 btn-press"
                onclick="if(confirm('确认退出系统？')) sendCommand('exit_app')">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content (New Layout) -->
    <main id="app-main" class="absolute inset-0 pt-28 pb-6 px-6 flex gap-6 z-10 pointer-events-none">

        <!-- Left Panel: Settings -->
        <div id="left-panel"
            class="pointer-events-auto w-96 glass-panel flex flex-col transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] origin-left drawer-open flex-shrink-0 rounded-2xl overflow-hidden shadow-2xl">
            <!-- Header -->
            <div class="p-5 border-b border-white/50 flex justify-between items-center bg-white/30 backdrop-blur-md">
                <h2 class="font-serif font-bold text-ink-800 flex items-center gap-2 text-sm">
                    <svg class="w-4 h-4 text-celadon-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                        </path>
                    </svg>
                    参数配置
                </h2>
                <button onclick="toggleDrawer('left-panel')"
                    class="text-ink-400 hover:text-ink-600 p-1 hover:bg-white/50 rounded-lg transition-colors"><svg
                        class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg></button>
            </div>

            <div class="flex-1 overflow-y-auto scroller p-5 space-y-6">
                <!-- Mode Switcher -->
                <div class="bg-white/40 p-1 rounded-xl flex shadow-inner shrink-0">
                    <button id="mode-tab-yolo" onclick="switchVisionMode(0)"
                        class="flex-1 py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 bg-porcelain-100 text-celadon-600 shadow-sm ring-1 ring-celadon-200/50">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                            </path>
                        </svg>
                        深度学习
                    </button>
                    <button id="mode-tab-template" onclick="switchVisionMode(1)"
                        class="flex-1 py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 text-ink-400 hover:text-ink-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z">
                            </path>
                        </svg>
                        传统视觉
                    </button>
                </div>

                <div class="space-y-4">
                    <!-- YOLO Controls (Preserved Structure) -->
                    <div id="yolo-controls" class="space-y-4">
                        <!-- Model Card -->
                        <div class="bg-porcelain-50/80 rounded-xl p-4 shadow-sm border border-celadon-100/50">
                            <label
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-3">
                                <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                    </path>
                                </svg>
                                主模型
                            </label>
                            <select id="model-select" onchange="sendCommand('change_model', this.value)"
                                class="w-full bg-porcelain-100/50 border border-celadon-200/50 rounded-lg py-2.5 px-3 text-xs font-bold font-mono text-ink-700 focus:ring-2 focus:ring-celadon-100 focus:border-celadon-400 transition-all outline-none cursor-pointer hover:bg-white text-ellipsis overflow-hidden">
                                <option value="">正在初始化系统...</option>
                            </select>
                        </div>

                        <!-- Multi-Model Fallback Card -->
                        <div
                            class="bg-gradient-to-br from-celadon-50/80 to-porcelain-50/80 rounded-xl p-4 shadow-sm border border-celadon-200/60">
                            <div class="flex items-center justify-between mb-3">
                                <label
                                    class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest">
                                    <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                    模型池
                                </label>
                                <!-- Toggle Switch -->
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enable-multi-model"
                                        onchange="toggleMultiModel(this.checked)" class="sr-only peer">
                                    <div
                                        class="w-9 h-5 bg-slate-200 rounded-full peer peer-checked:bg-celadon-500 transition-colors after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-4">
                                    </div>
                                    <span class="ml-2 text-[9px] text-ink-500" id="multi-model-status">自动切换</span>
                                </label>
                            </div>

                            <div id="multi-model-config"
                                class="space-y-3 opacity-50 pointer-events-none transition-all">
                                <!-- Auxiliary Model 1 -->
                                <div>
                                    <div class="flex items-center gap-1.5 mb-1.5">
                                        <span
                                            class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-amber-100 text-amber-600 text-[9px] font-bold">1</span>
                                        <span class="text-[10px] font-bold text-ink-600">辅助模型 1</span>
                                    </div>
                                    <select id="auxiliary1-select"
                                        onchange="sendCommand('set_auxiliary1_model', this.value)"
                                        class="w-full bg-white/80 border border-amber-200/50 rounded-lg py-2 px-2.5 text-[10px] font-mono font-medium text-ink-600 focus:ring-2 focus:ring-amber-100 focus:border-amber-300 transition-all outline-none cursor-pointer hover:bg-white">
                                        <option value="">不使用</option>
                                    </select>
                                </div>

                                <!-- Auxiliary Model 2 -->
                                <div>
                                    <div class="flex items-center gap-1.5 mb-1.5">
                                        <span
                                            class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-rose-100 text-rose-600 text-[9px] font-bold">2</span>
                                        <span class="text-[10px] font-bold text-ink-600">辅助模型 2</span>
                                    </div>
                                    <select id="auxiliary2-select"
                                        onchange="sendCommand('set_auxiliary2_model', this.value)"
                                        class="w-full bg-white/80 border border-rose-200/50 rounded-lg py-2 px-2.5 text-[10px] font-mono font-medium text-ink-600 focus:ring-2 focus:ring-rose-100 focus:border-rose-300 transition-all outline-none cursor-pointer hover:bg-white">
                                        <option value="">不使用</option>
                                    </select>
                                </div>

                                <!-- Fallback Indicator -->
                                <div id="fallback-indicator"
                                    class="hidden bg-gradient-to-r from-celadon-50 to-amber-50 rounded-lg p-2 border border-celadon-100">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 rounded-full bg-celadon-500 animate-pulse"></div>
                                        <span class="text-[9px] font-bold text-ink-600">当前激活: <span
                                                id="active-model-name" class="text-celadon-600">主模型</span></span>
                                    </div>
                                </div>
                            </div>

                            <p class="mt-2 text-[8px] text-ink-400 italic">主模型未检测到时自动切换辅助模型</p>
                        </div>

                        <!-- Task Type Selector -->
                        <div class="bg-porcelain-50/80 rounded-xl p-4 shadow-sm border border-celadon-100/50">
                            <label
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-3">
                                <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4">
                                    </path>
                                </svg>
                                任务类型
                            </label>
                            <select id="task-type-select" onchange="updateTaskType(this.value)"
                                class="w-full bg-porcelain-100/50 border border-celadon-200/50 rounded-lg py-2.5 px-3 text-xs font-bold text-ink-700 focus:ring-2 focus:ring-celadon-100 focus:border-celadon-400 transition-all outline-none cursor-pointer hover:bg-white">
                                <option value="1" selected>目标检测 (Detect)</option>
                                <option value="0">图像分类 (Classify)</option>
                                <option value="3">实例分割 (Segment)</option>
                                <option value="5">姿态估计 (Pose)</option>
                                <option value="6">旋转框检测 (OBB)</option>
                            </select>
                            <p class="mt-2 text-[9px] text-ink-400 italic">请根据模型实际支持的任务选择</p>
                        </div>

                        <!-- Conf/IOU Sliders -->
                        <div class="bg-porcelain-50/80 rounded-xl p-4 shadow-sm border border-celadon-100/50 space-y-4">
                            <label
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-1">
                                <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                                    </path>
                                </svg>
                                检测阈值
                            </label>
                            <div>
                                <div class="flex justify-between items-center mb-1.5"><span
                                        class="text-[11px] font-bold text-ink-600">Conf.</span><span id="conf-value"
                                        class="text-[11px] font-mono font-bold text-celadon-600 bg-celadon-50 px-1.5 rounded">0.50</span>
                                </div>
                                <input type="range" min="10" max="95" value="50" step="5" id="conf-slider"
                                    oninput="updateConfidence(this.value)"
                                    class="w-full accent-celadon-600 h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1.5"><span
                                        class="text-[11px] font-bold text-ink-600">IOU</span><span id="iou-value"
                                        class="text-[11px] font-mono font-bold text-celadon-600 bg-celadon-50 px-1.5 rounded">0.30</span>
                                </div>
                                <input type="range" min="10" max="90" value="30" step="5" id="iou-slider"
                                    oninput="updateIou(this.value)"
                                    class="w-full accent-celadon-600 h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div id="perf-metrics"
                            class="bg-porcelain-50/80 rounded-xl p-4 shadow-sm border border-celadon-100/50 hidden">
                            <label
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-2">
                                <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                性能分析
                            </label>
                            <div class="relative h-20">
                                <canvas id="inferenceChart"></canvas>
                            </div>
                            <div class="flex justify-between mt-2 text-[10px] font-mono font-bold text-ink-500">
                                <span>FPS: <span id="perf-fps" class="text-celadon-600">0.0</span></span>
                                <span>Total: <span id="perf-total" class="text-celadon-600">0</span>ms</span>
                            </div>
                        </div>

                        <!-- Advanced (Simplified) -->
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100/80 space-y-3">
                            <h4
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest">
                                <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                高级设定
                            </h4>
                            <div class="grid grid-cols-2 gap-2">


                            </div>

                            <button onclick="sendCommand('test_yolo')"
                                class="w-full py-2 bg-ink-800 text-white font-bold text-[10px] rounded-lg hover:bg-ink-900 transition-all uppercase tracking-wider shadow-md">测试推理</button>
                        </div>
                    </div>

                    <!-- Template Controls (Cleaned up) -->
                    <div id="template-controls" class="hidden space-y-4">
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100/80">
                            <div class="flex justify-between items-center mb-3">
                                <label
                                    class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest">
                                    <svg class="w-3.5 h-3.5 text-celadon-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                        </path>
                                    </svg>
                                    处理流程
                                </label>
                                <button onclick="openAddOperatorMenu()"
                                    class="px-2 py-1 bg-celadon-50 text-celadon-600 hover:bg-celadon-100 text-[10px] font-bold rounded flex items-center gap-1 transition-all"><svg
                                        class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4"></path>
                                    </svg>添加</button>
                            </div>
                            <div id="operator-list"
                                class="space-y-2 min-h-[80px] border border-dashed border-celadon-200 rounded-lg p-2 bg-porcelain-100/50 relative">
                                <div class="absolute inset-0 flex items-center justify-center pointer-events-none"><span
                                        class="text-[10px] text-celadon-300 italic">点击右上角添加算子...</span></div>
                            </div>
                        </div>

                        <div class="bg-porcelain-50 rounded-xl p-4 shadow-sm border border-celadon-100/80 space-y-3">
                            <label
                                class="flex items-center gap-2 text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-1">调试与测试</label>
                            <button onclick="requestPreview()"
                                class="w-full py-2.5 bg-porcelain-100 text-ink-600 font-bold text-[10px] rounded-lg hover:bg-porcelain-200 transition-all uppercase tracking-wider flex items-center justify-center gap-2">刷新预览</button>
                            <button onclick="sendCommand('test_template_match')"
                                class="w-full py-2.5 bg-ink-800 text-white font-bold text-[10px] rounded-lg hover:bg-ink-900 transition-all uppercase tracking-wider flex items-center justify-center gap-2 shadow-lg">上传图片测试</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center: Camera -->
        <div
            class="pointer-events-auto flex-1 glass-panel relative overflow-hidden group flex flex-col transition-all duration-500 rounded-2xl shadow-float z-0">
            <!-- Top Bar (Camera Info) -->
            <div
                class="absolute top-0 left-0 right-0 h-10 bg-white/30 backdrop-blur-md flex justify-between items-center px-4 z-20 border-b border-white/20">
                <div class="flex items-center gap-2">
                    <span
                        class="w-1.5 h-1.5 rounded-full bg-celadon-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.6)]"></span>
                    <span id="camera-name-display"
                        class="font-mono text-[10px] font-bold text-ink-600 tracking-wider">CAM-01: ONLINE</span>
                </div>
            </div>

            <!-- Image Area -->
            <div id="camera-container"
                class="flex-1 relative bg-porcelain-100/50 flex items-center justify-center overflow-hidden">
                <img id="camera-view"
                    src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4MCIgaGVpZ2h0PSI3MjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2YxZjVmOSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iJ05vdG8gU2VyaWYgU0MnLCBzZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzk0YTNiOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgbGV0dGVyLXNwYWNpbmc9IjAuZW0iPuW+heacuuWQr+WKqC4uLjwvdGV4dD48L3N2Zz4="
                    class="w-full h-full object-contain mix-blend-multiply transition-all duration-300" alt="Camera">
                <canvas id="roi-canvas" class="absolute inset-0 z-20 cursor-crosshair pointer-events-auto"></canvas>

                <!-- Result Overlay -->
                <div id="result-overlay"
                    class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-30 flex-col items-center pointer-events-none">
                    <div
                        class="bg-porcelain-50/95 backdrop-blur-md border border-celadon-100 px-12 py-8 rounded-2xl shadow-2xl transform transition-all duration-300">
                        <span id="result-text"
                            class="font-black text-6xl tracking-widest font-serif text-ink-800">PASS</span>
                    </div>
                </div>
            </div>

            <!-- Floating Open Buttons (Visible when drawers closed) -->
            <button id="float-btn-left" onclick="toggleDrawer('left-panel')"
                class="absolute top-1/2 -translate-y-1/2 left-4 p-3 bg-porcelain-50/80 backdrop-blur rounded-full shadow-lg border border-celadon-100 hover:scale-110 transition-all text-ink-500 hover:text-celadon-600 z-30 opacity-0 pointer-events-none drawer-trigger">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7">
                    </path>
                </svg>
            </button>
            <button id="float-btn-right" onclick="toggleDrawer('right-panel')"
                class="absolute top-1/2 -translate-y-1/2 right-4 p-3 bg-porcelain-50/80 backdrop-blur rounded-full shadow-lg border border-celadon-100 hover:scale-110 transition-all text-ink-500 hover:text-celadon-600 z-30 opacity-0 pointer-events-none drawer-trigger">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 19l-7-7 7-7M19 19l-7-7 7-7"></path>
                </svg>
            </button>
        </div>

        <!-- Right Panel: Stats & Logs -->
        <div id="right-panel"
            class="pointer-events-auto w-96 flex flex-col gap-3 transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] origin-right drawer-open flex-shrink-0 pointer-events-auto glass-panel border-l border-white/40 h-full">
            <!-- Stats Card -->
            <div class="glass-panel p-5 relative overflow-hidden group rounded-2xl shrink-0 flex flex-col bg-white/40">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center gap-2">
                        <button onclick="toggleDrawer('right-panel')"
                            class="text-ink-400 hover:text-ink-600 p-1 hover:bg-white/50 rounded-lg transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                                </path>
                            </svg>
                        </button>
                        <h3 class="font-bold text-ink-800 text-sm" style="font-family: 'Microsoft YaHei'">今日产出</h3>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="openGalleryModal()"
                            class="p-1.5 rounded-lg bg-white/50 hover:bg-celadon-50 text-ink-400 hover:text-celadon-600 transition-all shadow-sm border border-transparent hover:border-celadon-200"
                            title="图像追溯库">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                        </button>
                        <button onclick="openStatisticsHistoryModal()"
                            class="p-1.5 rounded-lg bg-porcelain-100/50 hover:bg-porcelain-200 text-ink-400 hover:text-celadon-600 transition-all shadow-sm border border-transparent hover:border-celadon-200"
                            title="历史统计报表">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="relative w-full aspect-[2/1] min-h-[120px] flex items-center justify-center pb-6">
                    <canvas id="statsChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none -mt-1">
                        <span class="text-[9px] text-ink-400 uppercase font-bold tracking-widest">Total</span>
                        <span id="val-total" class="font-mono text-2xl font-bold text-ink-800">0</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-auto">
                    <div class="bg-bamboo-50 border border-bamboo-100 rounded-lg p-2 text-center">
                        <div class="text-[9px] text-bamboo-600 font-bold uppercase">Pass</div>
                        <div id="val-ok" class="text-lg font-mono text-bamboo-600 font-bold">0</div>
                    </div>
                    <div class="bg-rouge-50 border border-rouge-100 rounded-lg p-2 text-center">
                        <div class="text-[9px] text-rouge-600 font-bold uppercase">Fail</div>
                        <div id="val-ng" class="text-lg font-mono text-rouge-600 font-bold">0</div>
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div class="glass-panel flex-1 flex flex-col overflow-hidden rounded-2xl bg-porcelain-50/40 min-h-0">
                <div class="p-3 border-b border-white/50 bg-white/30 flex justify-between items-center shrink-0">
                    <span class="text-xs font-bold text-ink-600" style="font-family: 'Microsoft YaHei'">检测流水</span>
                    <div class="flex gap-1">
                        <button onclick="openLogHistoryModal()"
                            class="p-1 rounded-lg hover:bg-porcelain-100 text-ink-400 hover:text-celadon-600 transition-all border border-transparent hover:border-celadon-200"
                            title="检测历史流水">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </button>
                        <button onclick="clearDetectionLogs()"
                            class="p-1 rounded-lg hover:bg-rouge-50 text-ink-400 hover:text-rouge-600 transition-all border border-transparent hover:border-rouge-100"
                            title="清空流水">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="detection-log-container" class="flex-1 overflow-y-auto scroller p-3 space-y-1"></div>
            </div>

            <!-- System Log (Mini) -->
            <div class="glass-panel h-32 flex flex-col overflow-hidden rounded-2xl bg-porcelain-800/10 shrink-0">
                <div class="px-3 py-1.5 border-b border-white/10 flex justify-between items-center shrink-0">
                    <span class="text-[10px] font-bold text-ink-500" style="font-family: 'Microsoft YaHei'">系统日志</span>
                    <button onclick="clearLogs()" class="text-[9px] text-ink-400 hover:text-ink-600">Clear</button>
                </div>
                <div id="log-container" class="flex-1 p-2 overflow-y-auto scroller space-y-1 font-mono text-[9px]">
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Dock Container (Separated) -->

    <!-- 1. The Dock Itself -->
    <div id="bottom-dock"
        class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-5 py-2 glass-panel rounded-2xl shadow-2xl dock-open animate-float transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] origin-bottom"
        style="animation-duration: 10s; animation-delay: 1s;">

        <!-- Collapse Handle (Added to allows closing since trigger is hidden) -->
        <button onclick="toggleDock()"
            class="absolute -top-4 left-1/2 -translate-x-1/2 w-16 h-4 bg-porcelain-100/60 hover:bg-porcelain-200 backdrop-blur rounded-t-xl flex items-center justify-center transition-all cursor-pointer shadow-sm border-t border-l border-r border-celadon-100/30 group">
            <svg class="w-3.5 h-3.5 text-ink-400 group-hover:text-celadon-600 transition-colors" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
        <div class="flex items-center gap-2">
            <button onclick="sendCommand('manual_detect')"
                class="px-4 py-2.5 rounded-xl bg-celadon-600 text-white shadow-lg shadow-celadon-900/40 hover:scale-105 hover:bg-celadon-700 transition-all active:scale-95 btn-press flex items-center gap-2 font-bold text-xs tracking-wide"
                title="手动触发">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>手动拍照</span>
            </button>
            <button onclick="sendCommand('manual_release')"
                class="px-4 py-2.5 rounded-xl bg-white text-gamboge-500 shadow-md border border-gamboge-100 hover:scale-105 hover:text-gamboge-600 transition-all active:scale-95 btn-press flex items-center gap-2 font-bold text-xs tracking-wide"
                title="强制放行">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                <span>强制放行</span>
            </button>
        </div>
        <div class="w-px h-8 bg-ink-900/10"></div>
        <div class="flex items-center gap-2">
            <button id="btn-open-camera" onclick="requestOpenCamera(this)"
                class="p-2.5 rounded-xl hover:bg-white/50 text-ink-600 transition-all" title="打开相机">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
            <button onclick="clearRoi()" class="p-2.5 rounded-xl hover:bg-white/50 text-ink-600 transition-all"
                title="清除ROI">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </button>
        </div>
    </div>

    <!-- 2. The Toggle Handle (Separated) - Enhanced Design -->
    <div id="dock-trigger-container"
        class="fixed bottom-0 left-1/2 -translate-x-1/2 z-[49] flex justify-center opacity-0 pointer-events-none transition-all duration-300">
        <button onclick="toggleDock()" id="dock-toggle-btn" class="group px-8 py-3 glass-panel rounded-t-2xl flex items-center justify-center gap-2 
                   bg-gradient-to-t from-porcelain-100 to-porcelain-50/70 hover:from-porcelain-200 hover:to-porcelain-100
                   border-t border-l border-r border-celadon-100/60
                   shadow-[0_-4px_20px_rgba(26,29,33,0.08)] hover:shadow-[0_-8px_30px_rgba(26,29,33,0.12)]
                   transition-all duration-300 ease-out
                   transform translate-y-1 hover:translate-y-0 active:scale-95">
            <!-- Animated Pulse Dot -->
            <span
                class="w-2 h-2 rounded-full bg-celadon-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.6)]"></span>
            <!-- Text Label -->
            <span class="text-xs font-bold text-ink-500 group-hover:text-celadon-600 tracking-wide transition-colors">
                工具栏
            </span>
            <!-- Arrow Icon -->
            <svg id="dock-arrow" class="w-4 h-4 text-ink-400 group-hover:text-celadon-600 transition-all duration-500"
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 15l7-7 7 7"></path>
            </svg>
        </button>
    </div>

    <!-- MODALS: 瓷感磨砂 -->

    <!-- Settings Modal -->
    <div id="settings-modal"
        class="fixed inset-0 bg-ink-900/40 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
            <div
                class="h-16 border-b border-celadon-100 flex justify-between items-center px-8 bg-porcelain-50/50 shrink-0">
                <h3 class="text-lg font-serif font-black text-ink-800 tracking-widest">系统参数配置 <span
                        class="text-xs font-sans font-normal text-ink-400 ml-2 italic">Configuration</span></h3>
                <button onclick="closeSettingsModal()"
                    class="p-2 hover:bg-red-50 text-ink-400 hover:text-vermilion rounded-full transition-all text-xl">&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto scroller p-8 space-y-8 bg-porcelain-100/30">
                <!-- 项目快速切换 (仅填充现有字段，不锁定修改) -->
                <div
                    class="mb-2 p-4 bg-gradient-to-r from-celadon-50 to-porcelain-50 rounded-xl border border-celadon-200 shadow-sm">
                    <label
                        class="flex items-center gap-2 text-[10px] font-bold text-celadon-700 uppercase tracking-widest mb-3">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                        </svg>
                        快速切换项目预设
                    </label>
                    <select id="project-preset-select" onchange="loadProjectPreset(this.value)"
                        class="w-full tech-input px-4 py-3 rounded-xl text-sm font-bold cursor-pointer border-2 border-celadon-200 focus:border-celadon-500 transition-all">
                        <option value="">-- 选择预设项目（可选）--</option>
                        <option value="N5_remote">N5遥控器漏装视觉检测</option>
                        <option value="N5_screw">N5螺钉视觉检测</option>
                        <option value="N6_remote">N6遥控器漏装视觉检测</option>
                        <option value="N6_screw">N6螺钉视觉检测</option>
                        <option value="W5_screw">W5螺钉视觉检测</option>
                        <option value="W6_screw">W6螺钉视觉检测</option>
                    </select>
                    <p class="text-[9px] text-ink-400 mt-2 italic">选择后自动填充下方配置项，填充后仍可手动修改各参数</p>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-ink-400 uppercase tracking-widest block">数据保存路径 /
                        Storage
                        Path</label>
                    <div class="flex gap-2">
                        <input id="cfg-storage-path" type="text" readonly
                            class="flex-1 tech-input px-4 py-2.5 rounded-xl text-xs font-bold" placeholder="未设置路径">
                        <button onclick="sendCommand('select_storage_folder')"
                            class="px-6 text-xs font-bold bg-white border border-slate-200 text-ink-600 hover:border-celadon-400 rounded-xl transition-all shadow-sm">浏览</button>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-6">
                    <div class="space-y-4">
                        <h3 class="text-[10px] font-serif font-black text-celadon-600 uppercase tracking-[0.2em]">
                            PLC
                            通讯配置</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-[10px] font-bold text-ink-400 mb-1 block">物理协议类型</label>
                                <select id="cfg-plc-protocol"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-bold cursor-pointer font-mono">
                                    <option value="Mitsubishi_MC_ASCII">Mitsubishi MC (ASCII)</option>
                                    <option value="Mitsubishi_MC_Binary">Mitsubishi MC (Binary)</option>
                                    <option value="Modbus_TCP">Modbus TCP</option>
                                    <option value="Siemens_S7">Siemens S7 (1200/1500)</option>
                                    <option value="Omron_Fins">Omron Fins TCP</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-[10px] text-ink-400 mb-1 block">IP地址</label>
                                    <input id="cfg-plc-ip"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono">
                                </div>
                                <div>
                                    <label class="text-[10px] text-ink-400 mb-1 block">端口</label>
                                    <input id="cfg-plc-port" type="number"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono">
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] text-ink-400 mb-1 block">触发地址</label>
                                <input id="cfg-plc-trigger"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="100 或 D100">
                            </div>
                            <div>
                                <label class="block text-[10px] text-ink-400 mb-1">结果地址</label>
                                <input id="cfg-plc-result"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="102 或 D102">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] text-ink-400 mb-1">触发延迟 (ms)</label>
                                    <input id="cfg-plc-trigger-delay" type="number" min="0" step="50"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="800">
                                </div>
                                <div>
                                    <label class="block text-[10px] text-ink-400 mb-1">轮询间隔 (ms)</label>
                                    <input id="cfg-plc-polling-interval" type="number" min="50" step="50"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-[10px] font-serif font-black text-celadon-600 uppercase tracking-[0.2em]">
                            检测逻辑配置
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] font-bold text-ink-400 mb-1 block">重拍次数 (Max Retries)</label>
                                <input id="cfg-logic-retry-count" type="number" min="0" max="5"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="1">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-ink-400 mb-1 block">重拍间隔 (Interval ms)</label>
                                <input id="cfg-logic-retry-interval" type="number" step="100" min="0"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="2000">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-ink-400 mb-1 block">检测目标标签 (Target
                                    Label)</label>
                                <input id="cfg-logic-target-label" type="text"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-bold"
                                    placeholder="wrapper">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-ink-400 mb-1 block">目标数量 (Target Count)</label>
                                <input id="cfg-logic-target-count" type="number"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono" placeholder="1">
                            </div>
                            <div class="col-span-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input id="cfg-yolo-gpu" type="checkbox"
                                        class="accent-celadon-600 w-3.5 h-3.5 rounded">
                                    <span class="text-[10px] font-bold text-ink-500">启用 GPU 加速 (CUDA)</span>
                                </label>
                            </div>
                            <div class="col-span-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input id="cfg-industrial-render-mode" type="checkbox" checked
                                        class="accent-celadon-600 w-3.5 h-3.5 rounded">
                                    <span class="text-[10px] font-bold text-ink-500">工业渲染模式（轻量绘制）</span>
                                </label>
                            </div>
                        </div>

                        <!-- 相机操作按钮 (移至中间栏) -->
                        <div class="mt-6 pt-4 border-t border-celadon-100/50">
                            <label
                                class="text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-3 block">相机操作</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="addNewCamera()"
                                    class="py-2 bg-celadon-600 hover:bg-celadon-700 text-white text-[10px] font-bold rounded-lg transition-all flex items-center justify-center gap-1">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    添加/更新
                                </button>
                                <button onclick="superSearchCameras()"
                                    class="py-2 bg-celadon-500 hover:bg-celadon-600 text-white rounded-lg transition-all text-[10px] font-bold flex items-center justify-center gap-1">
                                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    华睿搜索
                                </button>
                                <button onclick="searchCamerasHik()"
                                    class="py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg transition-all text-[10px] font-bold flex items-center justify-center gap-1">
                                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    海康搜索
                                </button>
                                <button onclick="deleteCurrentCamera()"
                                    class="py-2 bg-rouge-50 hover:bg-rouge-100 text-rouge-600 text-[10px] font-bold rounded-lg transition-all border border-rouge-100">
                                    删除相机
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 相机参数配置 (第三列) -->
                    <div class="space-y-4">
                        <h3 class="text-[10px] font-serif font-black text-celadon-600 uppercase tracking-[0.2em]">
                            相机参数配置
                        </h3>
                        <div class="space-y-3">
                            <!-- 相机选择 -->
                            <div>
                                <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">选择相机</label>
                                <div class="flex gap-2">
                                    <select id="cfg-cam-select"
                                        class="flex-1 tech-input px-3 py-2 rounded-lg text-xs font-bold cursor-pointer"
                                        onchange="onCameraSelected(this.value)">
                                        <option value="">正在加载相机列表...</option>
                                    </select>
                                    <button onclick="sendCommand('get_camera_list')"
                                        class="px-3 py-2 bg-celadon-50 text-celadon-600 hover:bg-celadon-100 text-[10px] font-bold rounded-lg transition-all"
                                        title="刷新相机列表">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                            </path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">显示名称</label>
                                <input id="cfg-cam-name"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-bold"
                                    placeholder="例: 主检测相机">
                            </div>
                            <div>
                                <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">相机品牌</label>
                                <select id="cfg-cam-manufacturer"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-bold cursor-pointer">
                                    <option value="Huaray">华睿 (Huaray)</option>
                                    <option value="Hikvision">海康威视 (Hikvision)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">序列号 /
                                    URI</label>
                                <input id="cfg-cam-serial"
                                    class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono"
                                    placeholder="例: EF59632AAK00074">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">曝光
                                        (μs)</label>
                                    <input id="cfg-cam-exposure"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono"
                                        placeholder="50000">
                                </div>
                                <div>
                                    <label class="block text-[10px] text-ink-400 mb-1 text-ink-500 font-bold">增益</label>
                                    <input id="cfg-cam-gain"
                                        class="w-full tech-input px-3 py-2 rounded-lg text-xs font-mono"
                                        placeholder="1.0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-slate-100">
                    <button onclick="if(confirm('确定要清除今日统计数据吗？此操作不可撤销！')) sendCommand('reset_statistics')"
                        class="w-full py-3 bg-vermilion/5 text-vermilion font-black text-[10px] rounded-xl hover:bg-vermilion/10 transition-all uppercase tracking-widest border border-vermilion/10 flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                        重置生产报表 / Reset Stats
                    </button>
                </div>
            </div>
            <div class="h-16 border-t border-slate-100 bg-white flex justify-end items-center px-8 gap-3 shrink-0">
                <button onclick="closeSettingsModal()"
                    class="px-6 py-2 text-xs font-bold text-ink-400 hover:text-ink-600 transition-colors">取消设置</button>
                <button onclick="saveSettings()"
                    class="btn-celadon px-10 py-2 rounded-xl text-xs font-bold shadow-float">保存并部署</button>
            </div>
        </div>
    </div>

    <!-- Super Search Modal -->
    <div id="super-search-modal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-[600px] max-h-[80vh] flex flex-col">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    相机超级搜索结果
                </h3>
                <button onclick="closeSuperSearchModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="super-search-loading" class="flex items-center justify-center py-8 text-slate-500">
                <svg class="animate-spin h-8 w-8 mr-3 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                正在搜索局域网中的相机...
            </div>
            <div id="super-search-results" class="flex-1 overflow-y-auto space-y-2 hidden">
                <!-- 动态填充相机列表 -->
            </div>
            <div id="super-search-empty" class="flex flex-col items-center justify-center py-8 text-slate-400 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-lg font-semibold">未发现任何相机</p>
                <p class="text-sm">请检查相机是否已连接到局域网</p>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal"
        class="fixed inset-0 bg-ink-900/60 backdrop-blur-md z-[100] hidden flex items-center justify-center">
        <div class="glass-panel w-80 rounded-2xl p-6 shadow-2xl flex flex-col items-center">
            <div class="w-12 h-12 bg-celadon-50 rounded-full flex items-center justify-center text-celadon-600 mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 00-2 2zm10-10V7a4 4 0 00-8 0v4h8z">
                    </path>
                </svg>
            </div>
            <h3 class="text-sm font-bold text-ink-800 mb-1">权限验证</h3>
            <p class="text-[11px] text-ink-400 mb-6 text-center italic">Admin Access Required</p>
            <input type="password" id="admin-password"
                class="w-full tech-input rounded-xl py-3 px-4 text-center text-lg tracking-[0.8em] mb-4 focus:ring-4 focus:ring-celadon-100"
                autofocus onkeypress="if(event.key==='Enter') verifyPassword()">
            <div class="flex w-full gap-2 mt-2">
                <button onclick="closePasswordModal()"
                    class="flex-1 py-2.5 text-xs font-bold text-ink-400 hover:bg-slate-50 rounded-xl transition-all">取消</button>
                <button onclick="verifyPassword()"
                    class="flex-1 py-2.5 bg-ink-800 text-white text-xs font-bold rounded-xl shadow-lg shadow-black/10 hover:bg-ink-950 transition-all">验证许可</button>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="gallery-modal" class="fixed inset-0 bg-ink-900/40 backdrop-blur-sm z-[60] hidden overflow-hidden">
        <div
            class="absolute inset-y-0 right-0 w-[80%] bg-white/95 shadow-2xl flex flex-col transform transition-transform duration-500 border-l border-slate-200">
            <header class="h-16 border-b border-slate-100 flex justify-between items-center px-8 bg-white shrink-0">
                <div class="flex items-center gap-4">
                    <h3 class="text-lg font-serif font-black text-ink-800 tracking-widest capitalize">图像追溯库 <span
                            class="text-[10px] font-sans font-normal text-ink-400 ml-2 uppercase italic tracking-normal">Recover
                            Samples</span></h3>
                    <div class="h-4 w-px bg-slate-200"></div>
                    <span id="gallery-count"
                        class="text-xs font-mono text-celadon-600 font-bold bg-celadon-50 px-2 py-0.5 rounded">Samples:
                        0</span>
                </div>
                <button onclick="closeGalleryModal()"
                    class="p-2 hover:bg-slate-100 rounded-full transition-all text-2xl">&times;</button>
            </header>

            <div class="flex flex-1 overflow-hidden">
                <div class="w-60 border-r border-slate-100 flex flex-col bg-slate-50/50 shrink-0">
                    <div class="p-5 border-b border-slate-100 bg-white">
                        <label
                            class="text-[9px] font-bold text-ink-400 uppercase tracking-widest block mb-1.5">日期检索</label>
                        <input type="date" id="gallery-date-picker"
                            class="w-full text-xs font-bold text-ink-700 bg-transparent border-none p-0 focus:ring-0"
                            onchange="updateNGDates()">
                    </div>
                    <div id="ng-date-list" class="flex-1 overflow-y-auto scroller p-3 space-y-1"></div>
                    <div id="ng-hour-list"
                        class="h-1/2 border-t border-slate-100 overflow-y-auto scroller p-3 space-y-1 bg-white/40">
                    </div>
                </div>

                <div id="ng-image-grid"
                    class="flex-1 grid grid-cols-4 lg:grid-cols-5 2xl:grid-cols-7 gap-4 p-8 overflow-y-auto scroller content-start bg-white/20">
                    <div
                        class="col-span-full h-full flex flex-col items-center justify-center text-ink-300 opacity-30 mt-20">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        <span class="text-sm font-serif italic">选择左侧目录开始追溯...</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="image-viewer"
            class="hidden absolute inset-0 bg-ink-950/98 z-[100] flex flex-col animate-fade-in backdrop-blur-xl">
            <div class="absolute top-8 right-8 z-[70]">
                <button onclick="closeImageViewer()"
                    class="text-white transition-all bg-rouge-500 hover:bg-rouge-600 shadow-lg p-4 rounded-full"
                    onmouseover="this.style.backgroundColor='#8b2323'"
                    onmouseout="this.style.backgroundColor='#9e2a2b'">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <img id="viewer-img" class="flex-1 w-full h-full object-contain p-8" src="">
            <div id="viewer-info"
                class="absolute bottom-8 left-1/2 -translate-x-1/2 text-white/80 font-mono text-xs bg-black/40 px-4 py-1.5 rounded-full border border-white/10 backdrop-blur whitespace-nowrap">
            </div>
        </div>
    </div>

    <!-- Log History Modal -->
    <div id="log-history-modal"
        class="fixed inset-0 bg-ink-900/40 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[85vh]">
            <div class="h-16 border-b border-slate-100 flex justify-between items-center px-8 bg-white shrink-0">
                <div class="flex items-center gap-4">
                    <h3 class="text-lg font-serif font-black text-ink-800 tracking-widest uppercase">检测详单追踪</h3>
                    <input type="date" id="log-date-picker"
                        class="tech-input rounded-lg px-4 py-1.5 text-xs font-bold ml-4"
                        onchange="updateDetectionLogTable()">
                    <span id="log-count-badge"
                        class="px-2 py-0.5 text-[10px] font-bold bg-celadon-50 text-celadon-600 rounded-full">0
                        条</span>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="sendCommand('get_detection_logs')"
                        class="px-4 py-1.5 text-xs font-bold text-celadon-600 bg-celadon-50 hover:bg-celadon-100 rounded-lg transition-colors">刷新同步</button>
                    <button onclick="closeLogHistoryModal()"
                        class="text-2xl text-ink-400 hover:text-vermilion transition-all">&times;</button>
                </div>
            </div>
            <div class="flex-1 overflow-auto p-6 scroller bg-slate-50/30">
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-soft">
                    <table class="w-full text-left border-collapse min-w-[900px]">
                        <thead>
                            <tr class="bg-slate-50/80 border-b border-slate-200">
                                <th class="px-4 py-3 text-[10px] font-bold text-ink-400 uppercase tracking-widest">
                                    时间戳 /
                                    TIMESTAMP</th>
                                <th
                                    class="px-4 py-3 text-[10px] font-bold text-ink-400 uppercase tracking-widest text-center">
                                    结果 / STATUS</th>
                                <th class="px-4 py-3 text-[10px] font-bold text-ink-400 uppercase tracking-widest">
                                    检测详情
                                    / DETAILS</th>
                            </tr>
                        </thead>
                        <tbody id="log-history-table"
                            class="text-[11px] text-ink-600 font-mono divide-y divide-slate-100">
                            <tr>
                                <td colspan="3" class="px-4 py-10 text-center text-ink-300 italic">点击"刷新"加载历史流水...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="h-12 border-t border-slate-100 bg-white/50 flex justify-between items-center px-8 shrink-0">
                <span class="text-[10px] text-ink-400 font-bold uppercase italic tracking-widest">Showing latest 500
                    records</span>
                <button onclick="sendCommand('export_log_csv')"
                    class="px-4 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-bold text-ink-600 hover:text-celadon-600 hover:border-celadon-300 transition-all flex items-center gap-2">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg> 导出 CSV
                </button>
            </div>
        </div>
    </div>

    <!-- Statistics History Modal -->
    <div id="statistics-history-modal"
        class="fixed inset-0 bg-ink-900/40 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-4xl rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[70vh]">
            <div class="h-16 border-b border-slate-100 flex justify-between items-center px-8 bg-white/80 shrink-0">
                <div class="flex items-center gap-4">
                    <h3 class="text-lg font-serif font-black text-ink-800 tracking-widest uppercase">历史统计数据对比</h3>
                    <span
                        class="px-2 py-0.5 text-[10px] font-bold bg-celadon-50 text-celadon-600 rounded-full">最近7天概览</span>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="requestStatisticsHistory()"
                        class="px-4 py-1.5 text-xs font-bold text-celadon-600 bg-celadon-50 hover:bg-celadon-100 rounded-lg transition-colors">刷新</button>
                    <button onclick="closeStatisticsHistoryModal()"
                        class="text-2xl text-ink-400 hover:text-vermilion transition-all p-1">&times;</button>
                </div>
            </div>
            <div class="flex-1 overflow-auto scroller p-6 bg-white/30">
                <table class="w-full text-xs border-collapse">
                    <thead class="sticky top-0 bg-slate-50/95 backdrop-blur z-10">
                        <tr
                            class="text-left text-ink-400 font-bold uppercase tracking-widest border-b border-slate-200">
                            <th class="px-4 py-4">生产日期</th>
                            <th class="px-4 py-4 text-center">总检测数</th>
                            <th class="px-4 py-4 text-center">合格 (OK)</th>
                            <th class="px-4 py-4 text-center">不合格 (NG)</th>
                            <th class="px-4 py-4 text-center">直通率 (Yield)</th>
                        </tr>
                    </thead>
                    <tbody id="statistics-history-table" class="divide-y divide-slate-100 text-ink-600 font-mono">
                        <tr>
                            <td colspan="5" class="px-4 py-10 text-center text-ink-300 italic">同步云端统计中...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="h-14 border-t border-slate-100 bg-white flex justify-end items-center px-8 gap-4 shrink-0">
                <button onclick="sendCommand('clear_stats_history')"
                    class="px-6 py-2 text-vermilion hover:bg-red-50 rounded-lg text-xs font-bold border border-red-50 transition-all uppercase">清空历史数据</button>
            </div>
        </div>
    </div>

    <!-- Add Operator Modal -->
    <div id="add-operator-modal"
        class="fixed inset-0 bg-ink-900/40 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div
            class="glass-panel w-[400px] rounded-3xl overflow-hidden shadow-2xl flex flex-col scale-in animate-fade-in bg-white/95">
            <div class="h-14 border-b border-slate-100 flex justify-between items-center px-6 bg-white/60 shrink-0">
                <h3 class="text-xs font-bold text-ink-800 uppercase tracking-widest font-serif">添加算子 / Add Operator
                </h3>
                <button onclick="closeAddOperatorModal()"
                    class="text-2xl text-ink-400 hover:text-ink-600 transition-all">&times;</button>
            </div>
            <div class="p-6 bg-white/40 flex flex-col gap-3" id="operator-options">
                <button onclick="addOperator('template_match')"
                    class="w-full flex items-center gap-4 p-4 rounded-xl border border-slate-100 bg-white hover:border-celadon-300 hover:bg-celadon-50 transition-all group">
                    <div
                        class="w-10 h-10 rounded-xl bg-slate-50 group-hover:bg-celadon-100 flex items-center justify-center text-ink-400 group-hover:text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="text-xs font-bold text-ink-800 tracking-wide">模板匹配 <span
                                class="text-[9px] text-ink-400 font-mono ml-2 uppercase">Template</span></div>
                        <div class="text-[10px] text-ink-400 mt-0.5">高精度固定位置校对</div>
                    </div>
                </button>
                <button onclick="addOperator('feature_match')"
                    class="w-full flex items-center gap-4 p-4 rounded-xl border border-slate-100 bg-white hover:border-celadon-300 hover:bg-celadon-50 transition-all group">
                    <div
                        class="w-10 h-10 rounded-xl bg-slate-50 group-hover:bg-celadon-100 flex items-center justify-center text-ink-400 group-hover:text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                            </path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="text-xs font-bold text-ink-800 tracking-wide">特征匹配 <span
                                class="text-[9px] text-ink-400 font-mono ml-2 uppercase">AKAZE</span></div>
                        <div class="text-[10px] text-ink-400 mt-0.5">抗旋转缩放复杂背景检测</div>
                    </div>
                </button>
                <button onclick="addOperator('orb_match')"
                    class="w-full flex items-center gap-4 p-4 rounded-xl border border-slate-100 bg-white hover:border-celadon-300 hover:bg-celadon-50 transition-all group">
                    <div
                        class="w-10 h-10 rounded-xl bg-slate-50 group-hover:bg-celadon-100 flex items-center justify-center text-ink-400 group-hover:text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="text-xs font-bold text-ink-800 tracking-wide">快速匹配 <span
                                class="text-[9px] text-ink-400 font-mono ml-2 uppercase">ORB</span></div>
                        <div class="text-[10px] text-ink-400 mt-0.5">极速实时运动补差</div>
                    </div>
                </button>
                <button onclick="addOperator('pyramid_shape_match')"
                    class="w-full flex items-center gap-4 p-4 rounded-xl border border-slate-100 bg-white hover:border-celadon-300 hover:bg-celadon-50 transition-all group">
                    <div
                        class="w-10 h-10 rounded-xl bg-slate-50 group-hover:bg-celadon-100 flex items-center justify-center text-ink-400 group-hover:text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="text-xs font-bold text-ink-800 tracking-wide">形状匹配 <span
                                class="text-[9px] text-ink-400 font-mono ml-2 uppercase">Pyramid</span></div>
                        <div class="text-[10px] text-ink-400 mt-0.5">工业级抗光照梯度匹配</div>
                    </div>
                </button>
                <button onclick="addOperator('background_diff')"
                    class="w-full flex items-center gap-4 p-4 rounded-xl border border-slate-100 bg-white hover:border-celadon-300 hover:bg-celadon-50 transition-all group">
                    <div
                        class="w-10 h-10 rounded-xl bg-slate-50 group-hover:bg-celadon-100 flex items-center justify-center text-ink-400 group-hover:text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2">
                            </path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="text-xs font-bold text-ink-800 tracking-wide">有无检测 <span
                                class="text-[9px] text-ink-400 font-mono ml-2 uppercase">Background</span></div>
                        <div class="text-[10px] text-ink-400 mt-0.5">基于背景差分的工业级有无检测</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Logic -->
    <script src="js/app.js"></script>
    <script src="js/ui.js"></script>
    <!-- Crop Modal -->
    <div id="cropModal" class="fixed inset-0 z-[110] hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-ink-950/80 backdrop-blur-md transition-opacity"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div
                    class="glass-panel relative transform overflow-hidden rounded-3xl bg-white/90 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl border border-white/20">
                    <!-- Header -->
                    <div class="px-8 pt-6 pb-5 border-b border-slate-100 flex justify-between items-center bg-white/60">
                        <div>
                            <h3
                                class="text-lg font-serif font-black text-ink-800 tracking-widest flex items-center gap-3">
                                <svg class="w-6 h-6 text-celadon-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z">
                                    </path>
                                </svg>
                                模板精准裁剪器 <span
                                    class="text-[10px] font-sans font-normal text-ink-400 uppercase tracking-widest ml-2 italic">Precision
                                    Cropper</span>
                            </h3>
                            <p class="mt-1 text-xs text-ink-400 italic font-serif">请定义检测基准区域，系统将自动锁定 1:1 特征比例</p>
                        </div>
                        <button onclick="closeCropper()"
                            class="p-2 hover:bg-rouge-50 text-ink-300 hover:text-rouge-600 rounded-full transition-all text-2xl">&times;</button>
                    </div>

                    <!-- Body -->
                    <div class="p-8 flex gap-8 bg-slate-50/20">
                        <!-- Image Container -->
                        <div
                            class="flex-1 bg-ink-950 rounded-2xl overflow-hidden relative border-4 border-white shadow-inner h-[500px]">
                            <img id="cropImage" src="" alt="Source" class="max-w-full block">
                        </div>

                        <!-- Toolbar -->
                        <div class="w-56 flex flex-col gap-5">
                            <div class="glass-panel p-5 rounded-2xl border border-white shadow-soft">
                                <span
                                    class="text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-3 block">实时采样预览</span>
                                <div class="w-full aspect-square bg-white rounded-xl overflow-hidden border border-slate-100 shadow-inner"
                                    id="cropPreview"></div>
                            </div>

                            <div class="glass-panel p-5 rounded-2xl border border-white shadow-soft space-y-3">
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="cropper.rotate(-90)"
                                        class="py-2.5 text-[10px] font-bold text-ink-600 bg-white hover:bg-slate-50 rounded-xl border border-slate-100 flex flex-col items-center gap-1 transition-all">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                                        </svg>
                                        左旋
                                    </button>
                                    <button onclick="cropper.rotate(90)"
                                        class="py-2.5 text-[10px] font-bold text-ink-600 bg-white hover:bg-slate-50 rounded-xl border border-slate-100 flex flex-col items-center gap-1 transition-all">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"></path>
                                        </svg>
                                        右旋
                                    </button>
                                </div>
                                <button onclick="if(cropper) cropper.reset()"
                                    class="w-full py-2.5 text-[10px] font-bold text-ink-400 bg-white hover:bg-slate-50 rounded-xl border border-slate-100 flex items-center justify-center gap-2 transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                        </path>
                                    </svg>
                                    重置视图
                                </button>
                                <button onclick="captureTemplate()"
                                    class="w-full py-3 text-[10px] font-bold text-vermilion bg-red-50 hover:bg-red-100 rounded-xl border border-red-100 flex items-center justify-center gap-2 transition-all shadow-sm shadow-red-500/10">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                                        </path>
                                    </svg>
                                    重新采样
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div
                        class="px-8 py-5 flex justify-end items-center border-t border-slate-100 bg-white/80 gap-4 shrink-0">
                        <button type="button" onclick="closeCropper()"
                            class="px-8 py-2.5 text-xs font-bold text-ink-400 hover:text-ink-600 transition-all">放弃采样</button>
                        <button type="button" onclick="confirmCrop()"
                            class="btn-celadon px-12 py-2.5 rounded-xl text-xs font-bold shadow-float flex items-center gap-2 scale-105">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                            确认基准模板
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Manager Modal -->
    <div id="template-manager-modal"
        class="fixed inset-0 z-[100] hidden bg-ink-900/40 backdrop-blur-sm flex items-center justify-center p-4">
        <div
            class="glass-panel w-full max-w-5xl h-[85vh] rounded-2xl overflow-hidden shadow-2xl flex flex-col bg-slate-50">
            <!-- Header -->
            <div class="h-16 border-b border-slate-100 flex justify-between items-center px-6 bg-white shrink-0">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-celadon-50 rounded-lg text-celadon-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-ink-800 uppercase tracking-widest font-serif">模板管理器 /
                            Template
                            Manager</h3>
                        <p class="text-[10px] text-ink-400 mt-0.5">为算子 <span id="tm-op-name"
                                class="font-mono font-bold text-celadon-600">-</span> 配置基准图像</p>
                    </div>
                </div>
                <button onclick="closeTemplateManager()"
                    class="p-2 text-ink-300 hover:text-rouge-600 transition-colors rounded-full hover:bg-rouge-50">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Sidebar -->
                <div class="w-64 bg-white border-r border-slate-100 p-4 flex flex-col gap-4 shrink-0">
                    <div class="space-y-2">
                        <div class="text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-2">图像来源 / Source
                        </div>
                        <button onclick="captureTemplateFrame()"
                            class="w-full flex items-center gap-3 p-3 rounded-xl border border-slate-100 bg-slate-50 hover:border-celadon-300 hover:bg-celadon-50 text-ink-600 hover:text-celadon-700 transition-all group">
                            <div
                                class="w-8 h-8 rounded-lg bg-white flex items-center justify-center text-ink-400 group-hover:text-celadon-500 shadow-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                                    </path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="text-xs font-bold">相机截取</div>
                                <div class="text-[9px] text-ink-400">Capture Frame</div>
                            </div>
                        </button>
                        <button onclick="document.getElementById('tm-file-input').click()"
                            class="w-full flex items-center gap-3 p-3 rounded-xl border border-slate-100 bg-slate-50 hover:border-celadon-300 hover:bg-celadon-50 text-ink-600 hover:text-celadon-700 transition-all group">
                            <div
                                class="w-8 h-8 rounded-lg bg-white flex items-center justify-center text-ink-400 group-hover:text-celadon-500 shadow-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="text-xs font-bold">本地文件</div>
                                <div class="text-[9px] text-ink-400">Load File</div>
                            </div>
                        </button>
                        <input type="file" id="tm-file-input" class="hidden" accept="image/*"
                            onchange="loadTemplateFile(this)">
                    </div>

                    <div class="h-px bg-porcelain-200 my-2"></div>

                    <div class="space-y-2">
                        <div class="text-[10px] font-bold text-ink-400 uppercase tracking-widest mb-2">微调 / Adjust
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="tmRotate(-90)"
                                class="p-2 border border-celadon-200 rounded-lg hover:bg-porcelain-100 text-xs font-bold text-ink-500">↺
                                左旋</button>
                            <button onclick="tmRotate(90)"
                                class="p-2 border border-celadon-200 rounded-lg hover:bg-porcelain-100 text-xs font-bold text-ink-500">↻
                                右旋</button>
                        </div>
                        <button onclick="tmReset()"
                            class="w-full p-2 border border-celadon-200 rounded-lg hover:bg-porcelain-100 text-xs font-bold text-ink-500">重置视图</button>
                    </div>

                    <div class="mt-auto">
                        <button onclick="saveTemplate()"
                            class="w-full py-3 bg-celadon-600 hover:bg-celadon-700 text-white rounded-xl shadow-lg shadow-celadon-900/20 text-xs font-bold flex items-center justify-center gap-2 transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                            应用到算子
                        </button>
                    </div>
                </div>

                <!-- Editor Area -->
                <div class="flex-1 bg-porcelain-100/50 p-8 flex items-center justify-center overflow-hidden relative">
                    <!-- Placeholder / Loading -->
                    <div id="tm-placeholder" class="text-center">
                        <div
                            class="w-16 h-16 bg-porcelain-200 rounded-2xl mx-auto mb-4 flex items-center justify-center text-celadon-300">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                        </div>
                        <p class="text-sm font-bold text-ink-400">请选择左侧来源导入图像</p>
                    </div>

                    <!-- Image Container -->
                    <div id="tm-editor-container" class="hidden w-full h-full">
                        <img id="tm-image" src="" alt="Template Source" class="max-w-full max-h-full block">
                    </div>
                </div>
            </div>
        </div>
    </div>



</html>
